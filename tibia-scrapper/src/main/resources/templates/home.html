<!DOCTYPE html>
<html lang="pt" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TibiaBuilder - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .tibiadata-card {
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.8);
            overflow: hidden;
            border: 1px solid #2a2a2a;
        }

        .tibiadata-header {
            background-color: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid #333;
            padding: 8px 12px;
            width: 100%;
            z-index: 5;
            position: relative;
        }

        .text-shadow-heavy {
            text-shadow: 2px 2px 3px #000, -2px -2px 3px #000, 2px -2px 3px #000, -2px 2px 3px #000, 0 0 10px #000, 0 0 15px #000;
        }

        #card-boss {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.1) 60%, rgba(0, 0, 0, 0.85) 100%), url('https://www.tibiawiki.com.br/images/f/f0/Client_Artwork_12.20.jpg');
        }

        #card-creature {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.1) 60%, rgba(0, 0, 0, 0.85) 100%), url('https://www.tibiawiki.com.br/images/b/b0/Background_Artwork_13.20.13560.jpg');
        }

        #card-rashid {
            background-color: #1a1a1a;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
        }

        #card-news {
            background-color: #111;
            background-image: none;
        }

        .sprite-container {
            position: relative;
            width: 108px;
            height: 108px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .creature-pedestal {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 104px;
            height: 104px;
            background-image: url('https://www.tibiawiki.com.br/images/b/ba/Boosted_Creature_Pedestal.gif');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            z-index: 1;
            filter: drop-shadow(0px 5px 5px rgba(0, 0, 0, 0.9));
        }

        #card-rashid .creature-pedestal {
            display: none;
        }

        .creature-sprite {
            position: relative;
            z-index: 2;
            width: 64px;
            height: 64px;
            object-fit: contain;
            filter: drop-shadow(0px 4px 3px rgba(0, 0, 0, 0.8));
            margin-bottom: 8px;
        }

        #rashid-img {
            margin-bottom: 0;
        }

        .info-icon {
            font-size: 0.85em;
            cursor: help;
            color: rgba(255, 255, 255, 0.5);
            transition: color 0.2s;
        }

        .info-icon:hover {
            color: #fff;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: #aaa;
            transition: all 0.2s ease;
            background: transparent;
            cursor: pointer;
        }

        .menu-item:hover,
        .menu-item[aria-expanded="true"] {
            background-color: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .menu-icon {
            width: 24px;
            text-align: center;
            margin-right: 12px;
            font-size: 1.1em;
        }

        .menu-text {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .menu-title {
            font-size: 0.95em;
            font-weight: 500;
            line-height: 1.2;
            color: #dfdfdf;
            transition: color 0.2s;
        }

        .menu-subtitle {
            font-size: 0.75em;
            color: #666;
            margin-top: 2px;
        }

        .menu-item:hover .menu-title {
            color: #fff;
        }

        .chevron-icon {
            font-size: 0.75rem;
            transition: transform 0.3s ease;
            color: #666;
        }

        .menu-item[aria-expanded="true"] .chevron-icon {
            transform: rotate(180deg);
            color: #fff;
        }

        .submenu-container {
            padding-left: 36px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: 4px;
            margin-bottom: 8px;
            border-left: 1px solid #333;
            margin-left: 23px;
        }

        .submenu-item {
            font-size: 0.85em;
            color: #888;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .submenu-item:hover {
            color: #00b7ff;
            background-color: rgba(0, 183, 255, 0.05);
        }

        .news-item {
            transition: background 0.2s;
            border-bottom: 1px solid #222 !important;
            padding: 12px 20px !important;
            cursor: pointer;
        }

        .news-item:last-child {
            border-bottom: none !important;
        }

        .news-item:hover {
            background-color: #1a1a1a !important;
        }

        .tibia-news-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e0e0e0;
        }

        .tibia-news-content a {
            color: #00b7ff;
            text-decoration: none;
        }

        .tibia-news-content a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body class="d-flex flex-column min-vh-100 bg-dark text-white">

    <nav class="navbar navbar-expand-lg navbar-dark bg-black border-secondary mb-4 position-relative">
        <div class="container-fluid px-lg-5 d-flex justify-content-between align-items-center">

            <div style="flex: 1;"></div>

            <div class="position-absolute top-50 start-50 translate-middle text-center" style="z-index: 10;">
                <a class="navbar-brand fw-bold text-warning fs-3 m-0" href="/">
                    <i class="fa-solid fa-dragon"></i> TibiaBuilder
                </a>
            </div>

            <div class="d-flex align-items-center justify-content-end gap-2" style="flex: 1;">
                <div class="d-flex align-items-center" sec:authorize="isAuthenticated()">

                    <div class="dropdown me-4 pe-2">
                        <button class="btn btn-sm btn-outline-light position-relative border-0" type="button"
                            id="dropdownNotificacoes" data-bs-toggle="dropdown" aria-expanded="false"
                            onclick="carregarNotificacoes()">
                            <i class="fa-solid fa-bell fs-5"></i>
                            <span id="notif-badge"
                                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none"
                                style="font-size: 0.6rem;">0</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end bg-dark border-secondary shadow"
                            aria-labelledby="dropdownNotificacoes"
                            style="width: 320px; max-height: 400px; overflow-y: auto;">
                            <li>
                                <h6 class="dropdown-header text-warning fw-bold border-bottom border-secondary">Últimas
                                    Atualizações</h6>
                            </li>
                            <div id="lista-notificacoes-preview">
                                <li class="text-center p-3 text-secondary"><i class="fas fa-spinner fa-spin"></i>
                                    Carregando...</li>
                            </div>
                            <li>
                                <hr class="dropdown-divider border-secondary">
                            </li>
                            <li><a class="dropdown-item text-center text-info small fw-bold py-2"
                                    href="/notificacoes">Ver todas as notificações</a></li>
                        </ul>
                    </div>

                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" id="dropdownUser"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa-solid fa-user"></i> <span class="d-none d-md-inline ms-1"
                                sec:authentication="name">Usuario</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end bg-dark border-secondary shadow"
                            aria-labelledby="dropdownUser">
                            <li sec:authorize="hasRole('ADMIN')"><a class="dropdown-item text-warning" href="/admin"><i
                                        class="fa-solid fa-gear me-2"></i> Painel Admin</a></li>
                            <li><a class="dropdown-item text-light" href="/perfil"><i
                                        class="fa-solid fa-user-pen me-2 text-warning"></i> Editar Perfil</a></li>
                            <li>
                                <hr class="dropdown-divider border-secondary opacity-50">
                            </li>
                            <li>
                                <form th:action="@{/logout}" method="post" class="m-0 p-0 px-2">
                                    <button type="submit" class="btn btn-sm btn-danger w-100 text-start"><i
                                            class="fa-solid fa-power-off me-2"></i> Sair</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>

                <div sec:authorize="!isAuthenticated()">
                    <a href="/login" class="btn btn-sm btn-warning fw-bold px-3"><i
                            class="fa-solid fa-right-to-bracket"></i> Entrar</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="container-fluid px-lg-5 mb-5 flex-grow-1 mt-2">
        <div class="row g-4">

            <aside class="col-lg-3 col-xl-2 order-1">
                <div class="sidebar-menu">

                    <a href="/comunidade" class="menu-item">
                        <i class="fa-solid fa-users text-primary menu-icon"></i>
                        <div class="menu-text">
                            <span class="menu-title">Comunidade</span>
                            <span class="menu-subtitle">Fórum e discussões</span>
                        </div>
                    </a>

                    <a href="#collapseEnciclopedia" class="menu-item" data-bs-toggle="collapse" role="button"
                        aria-expanded="false" aria-controls="collapseEnciclopedia">
                        <i class="fa-solid fa-book-open text-warning menu-icon"></i>
                        <div class="menu-text">
                            <span class="menu-title">Enciclopédia</span>
                            <span class="menu-subtitle">Base de dados</span>
                        </div>
                        <i class="fa-solid fa-chevron-down chevron-icon"></i>
                    </a>

                    <div class="collapse" id="collapseEnciclopedia">
                        <div class="submenu-container">
                            <a href="#" class="submenu-item">Vocações</a>
                            <a href="/enciclopedia/equipamentos" class="submenu-item">Equipamentos</a>
                            <a href="#" class="submenu-item">Runas</a>
                            <a href="#" class="submenu-item">Magias</a>
                            <a href="#" class="submenu-item">Criaturas</a>
                            <a href="#" class="submenu-item">Imbuements</a>
                        </div>
                    </div>

                    <a href="#" class="menu-item" style="pointer-events: none; opacity: 0.5;">
                        <i class="fa-solid fa-users-viewfinder text-info menu-icon"></i>
                        <div class="menu-text">
                            <span class="menu-title">Buscar Party <span class="badge bg-danger ms-1 fw-normal"
                                    style="font-size: 0.6em;">EM BREVE</span></span>
                            <span class="menu-subtitle">Encontre jogadores</span>
                        </div>
                    </a>

                    <a href="#" class="menu-item" style="pointer-events: none; opacity: 0.5;">
                        <i class="fa-solid fa-map-location-dot text-danger menu-icon"></i>
                        <div class="menu-text">
                            <span class="menu-title">Hunts <span class="badge bg-danger ms-1 fw-normal"
                                    style="font-size: 0.6em;">EM BREVE</span></span>
                            <span class="menu-subtitle">Locais de caça</span>
                        </div>
                    </a>

                    <a href="/set-builder" class="menu-item">
                        <i class="fa-solid fa-user-shield text-success menu-icon"></i>
                        <div class="menu-text">
                            <span class="menu-title">Set Builder</span>
                            <span class="menu-subtitle">Simulador de status</span>
                        </div>
                    </a>

                    <a href="#" class="menu-item" style="pointer-events: none; opacity: 0.5;">
                        <i class="fa-solid fa-handshake menu-icon" style="color: #ffc107;"></i>
                        <div class="menu-text">
                            <span class="menu-title">Trade Market <span class="badge bg-danger ms-1 fw-normal"
                                    style="font-size: 0.6em;">EM BREVE</span></span>
                            <span class="menu-subtitle">Compra e venda</span>
                        </div>
                    </a>

                </div>
            </aside>

            <div class="col-lg-6 col-xl-8 order-3 order-lg-2">
                <div style="width: 95%; margin: 0 auto;">
                    <div class="tibiadata-card pb-0" id="card-news">
                        <div class="tibiadata-header d-flex justify-content-between align-items-center">
                            <h6 class="text-info fw-bold mb-0 text-shadow-heavy" style="font-size: 1em;">
                                <i class="fa-solid fa-newspaper me-1"></i> Últimas Notícias
                            </h6>
                            <a href="https://www.tibia.com/news/?subtopic=latestnews" target="_blank"
                                class="text-secondary small text-decoration-none">Ver site oficial <i
                                    class="fa-solid fa-arrow-up-right-from-square ms-1"
                                    style="font-size: 0.8em;"></i></a>
                        </div>
                        <div class="list-group list-group-flush bg-transparent pt-1 pb-0 mb-0" id="news-list">
                            <div class="text-center text-secondary py-5"><i
                                    class="fas fa-spinner fa-spin fs-3 mb-2"></i><br>Buscando notícias...</div>
                        </div>
                    </div>
                </div>
            </div>

            <aside class="col-lg-3 col-xl-2 order-2 order-lg-3 d-flex flex-column gap-3">

                <div class="tibiadata-card text-center" id="card-rashid">
                    <div class="tibiadata-header d-flex justify-content-center align-items-center">
                        <h6 class="text-info fw-bold mb-0 text-shadow-heavy" style="font-size: 1em;">
                            Rashid hoje
                            <i class="fa-solid fa-circle-info ms-1 info-icon" data-bs-toggle="tooltip"
                                data-bs-placement="top"
                                title="Localização atual do NPC Rashid (atualizada automaticamente com o Server Save)."></i>
                        </h6>
                    </div>
                    <div class="d-flex flex-column justify-content-center align-items-center py-2">
                        <div class="sprite-container">
                            <div class="creature-pedestal"></div>
                            <img id="rashid-img" src="https://www.tibiawiki.com.br/images/f/f5/Rashid.gif" alt="Rashid"
                                class="creature-sprite">
                        </div>

                        <div style="z-index: 5; font-size: 0.95em;" class="fw-bold text-light text-shadow-heavy mt-1">
                            <span id="rashid-city">Calculando...</span>
                            <a href="javascript:void(0)" onclick="abrirMapaRashid()"
                                class="text-warning text-decoration-none ms-1 transition"
                                title="Ver no Mapa interativo">
                                <i class="fa-solid fa-location-dot"></i>
                            </a>
                        </div>

                    </div>
                </div>

                <div class="tibiadata-card text-center" id="card-boss">
                    <div class="tibiadata-header d-flex justify-content-center align-items-center">
                        <h6 class="text-warning fw-bold mb-0 text-shadow-heavy" style="font-size: 1em;">
                            Boosted Boss
                            <i class="fa-solid fa-circle-info ms-1 info-icon" data-bs-toggle="tooltip"
                                data-bs-placement="top"
                                title="Boss diário com bônus de loot e equipamentos extras ao ser derrotado hoje."></i>
                        </h6>
                    </div>
                    <div class="d-flex flex-column justify-content-center align-items-center py-2">
                        <div class="sprite-container">
                            <div class="creature-pedestal"></div>
                            <img id="boosted-boss-img" src="https://www.tibiawiki.com.br/images/b/b4/Unknown_Item.gif"
                                alt="Boss" class="creature-sprite">
                        </div>
                        <span id="boosted-boss-name" class="fw-bold text-light text-shadow-heavy"
                            style="z-index: 5; font-size: 1em;">Carregando...</span>
                    </div>
                </div>

                <div class="tibiadata-card text-center" id="card-creature">
                    <div class="tibiadata-header d-flex justify-content-center align-items-center">
                        <h6 class="text-success fw-bold mb-0 text-shadow-heavy" style="font-size: 1em;">
                            Boosted Creature
                            <i class="fa-solid fa-circle-info ms-1 info-icon" data-bs-toggle="tooltip"
                                data-bs-placement="top"
                                title="Criatura diária que concede 2x Experiência, 2x Loot e renasce muito mais rápido."></i>
                        </h6>
                    </div>
                    <div class="d-flex flex-column justify-content-center align-items-center py-2">
                        <div class="sprite-container">
                            <div class="creature-pedestal"></div>
                            <img id="boosted-creature-img"
                                src="https://www.tibiawiki.com.br/images/b/b4/Unknown_Item.gif" alt="Creature"
                                class="creature-sprite">
                        </div>
                        <span id="boosted-creature-name" class="fw-bold text-light text-shadow-heavy"
                            style="z-index: 5; font-size: 1em;">Carregando...</span>
                    </div>
                </div>

            </aside>

        </div>
    </main>

    <div class="modal fade" id="newsModal" tabindex="-1" aria-labelledby="newsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
            <div class="modal-content bg-dark border-secondary text-white">
                <div class="modal-header border-secondary bg-black">
                    <h5 class="modal-title fw-bold text-info" id="newsModalLabel">
                        <i class="fa-solid fa-newspaper me-2"></i> <span id="modal-news-title">Carregando...</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 bg-black tibia-news-content" id="modal-news-body">
                    <div class="text-center py-5 text-secondary">
                        <i class="fas fa-spinner fa-spin fs-2 mb-3"></i>
                        <p>A carregar conteúdo do Tibia.com...</p>
                    </div>
                </div>
                <div class="modal-footer border-secondary bg-black d-flex justify-content-between">
                    <div>
                        <button id="btn-traduzir" class="btn btn-warning btn-sm fw-bold me-2"
                            onclick="traduzirTextoModal()" data-translated="false" style="display: none;">
                            <i class="fa-solid fa-language me-1"></i> Traduzir para PT
                        </button>
                        <a href="#" id="modal-news-link" target="_blank" class="btn btn-outline-info btn-sm">
                            <i class="fa-solid fa-arrow-up-right-from-square me-1"></i> Ver no Site
                        </a>
                    </div>
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="mapaRashidModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-transparent border-0 position-relative">

                <button type="button" class="btn-close btn-close-white position-absolute" data-bs-dismiss="modal"
                    aria-label="Close"
                    style="top: 15px; right: 15px; z-index: 1050; background-color: rgba(0,0,0,0.7); padding: 10px; border-radius: 50%;"></button>

                <div class="modal-body p-0 bg-dark position-relative shadow-lg"
                    style="height: 500px; border-radius: 12px; overflow: hidden; border: 2px solid #444;">

                    <iframe id="modal-rashid-iframe" src="" width="100%" height="100%" frameborder="0"
                        style="border:0;"></iframe>

                    <div class="position-absolute bottom-0 start-50 translate-middle-x w-100 text-center pb-4"
                        style="pointer-events: none;">
                        <span id="modal-rashid-desc" class="text-white"
                            style="font-size: 1.1rem; text-shadow: 2px 2px 4px #000, -1px -1px 4px #000, 1px -1px 4px #000, -1px 1px 4px #000, 0 0 10px #000;">
                            Carregando...
                        </span>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <footer class="bg-black text-center text-secondary py-4 border-top border-dark mt-auto">
        <div class="container">
            <small>&copy; 2026 TibiaBuilder Project. Dados obtidos via TibiaData API e TibiaWiki.</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/scripts/scripts.js}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });

        let rashidDataHoje = {};

        function atualizarRashid() {
            const now = new Date();
            const utcHour = now.getUTCHours();
            let day = now.getUTCDay();

            if (utcHour < 8) {
                day = day === 0 ? 6 : day - 1;
            }

            const rashidData = {
                1: { city: "Svargrond", bg: "https://www.tibiawiki.com.br/images/8/8c/Rashid_Svargrond.png", coords: "32210,31158,7", desc: "Em Svargrond, na Taverna Dankwart, sul do templo." },
                2: { city: "Liberty Bay", bg: "https://www.tibiawiki.com.br/images/2/22/Rashid_Liberty_Bay.png", coords: "32301,32837,7", desc: "Na taverna de Lyonel ao oeste do depot, Liberty Bay" },
                3: { city: "Port Hope", bg: "https://www.tibiawiki.com.br/images/4/4e/Rashid_Port_Hope.png", coords: "32578,32754,7", desc: "Na taverna de Clyde ao norte do barco, em Port Hope." },
                4: { city: "Ankrahmun", bg: "https://www.tibiawiki.com.br/images/d/dd/Rashid_Ankrahmun.png", coords: "33070,32882,6", desc: "Em Ankhramun, na taverna de Arito, acima do post office." },
                5: { city: "Darashia", bg: "https://www.tibiawiki.com.br/images/a/ab/Rashid_Darashia.png", coords: "33235,32485,7", desc: "Na cidade de Darashia, na taverna de Miraia, a oeste do barco." },
                6: { city: "Edron", bg: "https://www.tibiawiki.com.br/images/6/6f/Rashid_Edron.png", coords: "33168,31809,6", desc: "Em Edron, na taverna de Mirabell, acima do depot." },
                0: { city: "Carlin", bg: "https://www.tibiawiki.com.br/images/8/87/Rashid_Carlin.png", coords: "32330,31782,6", desc: "Em Carlin, no primeiro andar do depot." }
            };

            rashidDataHoje = rashidData[day];

            document.getElementById('rashid-city').innerText = rashidDataHoje.city;
            document.getElementById('card-rashid').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.1) 40%, rgba(0,0,0,0.1) 60%, rgba(0,0,0,0.85) 100%), url('${rashidDataHoje.bg}')`;
        }

        function abrirMapaRashid() {
            const modal = new bootstrap.Modal(document.getElementById('mapaRashidModal'));

            document.getElementById('modal-rashid-desc').innerText = rashidDataHoje.desc;

            const embedUrl = `https://tibiamaps.io/map/embed#${rashidDataHoje.coords}:2`;
            document.getElementById('modal-rashid-iframe').src = embedUrl;

            modal.show();
        }

        window.currentNewsHtml = "";

        function abrirNoticiaModal(id, type, date, url) {
            const modal = new bootstrap.Modal(document.getElementById('newsModal'));
            modal.show();

            const titleEl = document.getElementById('modal-news-title');
            const bodyEl = document.getElementById('modal-news-body');
            const linkEl = document.getElementById('modal-news-link');
            const btnTraduzir = document.getElementById('btn-traduzir');

            btnTraduzir.style.display = 'none';
            btnTraduzir.dataset.translated = "false";
            btnTraduzir.classList.replace('btn-secondary', 'btn-warning');
            btnTraduzir.innerHTML = '<i class="fa-solid fa-language me-1"></i> Traduzir para PT';

            titleEl.innerText = `${type} - ${date}`;
            linkEl.href = url;
            bodyEl.innerHTML = `
                <div class="text-center py-5 text-secondary">
                    <i class="fas fa-spinner fa-spin fs-2 mb-3"></i>
                    <p>A carregar conteúdo do Tibia.com...</p>
                </div>`;

            if (!id) {
                bodyEl.innerHTML = `<div class="text-warning p-3">Não foi possível identificar o ID desta notícia. Por favor, leia no site oficial.</div>`;
                return;
            }

            fetch(`https://api.tibiadata.com/v4/news/id/${id}`)
                .then(res => res.json())
                .then(data => {
                    if (data.news && data.news.content) {
                        window.currentNewsHtml = data.news.content;
                        bodyEl.innerHTML = window.currentNewsHtml;
                        btnTraduzir.style.display = 'inline-block';
                    } else if (data.news && data.news.content === "") {
                        bodyEl.innerHTML = `<div class="text-warning p-3">O conteúdo desta notícia não está disponível através da API. Pode lê-la clicando no botão abaixo.</div>`;
                    }
                })
                .catch(e => {
                    console.error(e);
                    bodyEl.innerHTML = `<div class="text-danger p-3"><i class="fa-solid fa-triangle-exclamation me-2"></i>Erro ao comunicar com a API do TibiaData.</div>`;
                });
        }

        async function traduzirTextoModal() {
            const bodyEl = document.getElementById('modal-news-body');
            const btn = document.getElementById('btn-traduzir');

            if (btn.dataset.translated === "true") {
                bodyEl.innerHTML = window.currentNewsHtml;
                btn.dataset.translated = "false";
                btn.classList.replace('btn-secondary', 'btn-warning');
                btn.innerHTML = '<i class="fa-solid fa-language me-1"></i> Traduzir para PT';
                return;
            }

            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> A traduzir...';
            btn.classList.replace('btn-warning', 'btn-secondary');

            let tempDiv = document.createElement('div');
            tempDiv.innerHTML = window.currentNewsHtml.replace(/<br\s*[\/]?>/gi, "\n").replace(/<\/p>/gi, "\n\n");

            let textLines = tempDiv.innerText.split('\n').filter(line => line.trim() !== '');

            let translatedLines = [];

            try {
                for (let line of textLines) {
                    if (line.trim().length === 0) continue;

                    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=pt&dt=t&q=${encodeURIComponent(line)}`;
                    const res = await fetch(url);
                    const data = await res.json();

                    let translatedText = data[0].map(item => item[0]).join('');
                    translatedLines.push(translatedText);
                }

                bodyEl.innerHTML = `<div class="text-light" style="font-size: 0.95em; line-height: 1.2;">` +
                    translatedLines.map(p => `<p>${p}</p>`).join('') +
                    `</div>`;

                btn.dataset.translated = "true";
                btn.innerHTML = '<i class="fa-solid fa-rotate-left me-1"></i> Ver Original';
            } catch (error) {
                console.error("Erro ao traduzir:", error);
                alert("Ocorreu um erro ao traduzir. Tente novamente mais tarde.");
                btn.classList.replace('btn-secondary', 'btn-warning');
                btn.innerHTML = '<i class="fa-solid fa-language me-1"></i> Traduzir para PT';
            }
        }

        async function fetchTibiaData() {
            try {
                fetch('https://api.tibiadata.com/v4/creatures')
                    .then(res => res.json())
                    .then(data => {
                        const creatureName = data.creatures.boosted.name;
                        const formattedName = creatureName.replace(/ /g, '_');
                        const animatedGif = `https://www.tibiawiki.com.br/wiki/Especial:Filepath/${encodeURIComponent(formattedName)}.gif`;

                        const imgEl = document.getElementById('boosted-creature-img');
                        imgEl.src = animatedGif;
                        imgEl.setAttribute('onerror', `this.onerror=null; this.src='${data.creatures.boosted.image_url}';`);

                        document.getElementById('boosted-creature-name').innerText = creatureName;
                    }).catch(e => console.error(e));

                fetch('https://api.tibiadata.com/v4/boostablebosses')
                    .then(res => res.json())
                    .then(data => {
                        const bossName = data.boostable_bosses.boosted.name;
                        const formattedName = bossName.replace(/ /g, '_');
                        const animatedGif = `https://www.tibiawiki.com.br/wiki/Especial:Filepath/${encodeURIComponent(formattedName)}.gif`;

                        const imgEl = document.getElementById('boosted-boss-img');
                        imgEl.src = animatedGif;
                        imgEl.setAttribute('onerror', `this.onerror=null; this.src='${data.boostable_bosses.boosted.image_url}';`);

                        document.getElementById('boosted-boss-name').innerText = bossName;
                    }).catch(e => console.error(e));

                fetch('https://api.tibiadata.com/v4/news/latest')
                    .then(res => res.json())
                    .then(data => {
                        const newsList = data.news.slice(0, 4);
                        const container = document.getElementById('news-list');
                        container.innerHTML = '';
                        newsList.forEach(news => {
                            let typeColor = 'text-primary';
                            if (news.type === 'News Ticker') typeColor = 'text-warning';
                            if (news.type === 'Featured Article') typeColor = 'text-success';

                            let newsId = '';
                            try {
                                const urlObj = new URL(news.url);
                                newsId = urlObj.searchParams.get('id');
                            } catch (e) {
                                if (news.url.includes('id=')) {
                                    newsId = news.url.split('id=')[1].split('&')[0];
                                }
                            }

                            container.innerHTML += `
                                <div class="list-group-item list-group-item-action bg-transparent news-item text-decoration-none"
                                     onclick="abrirNoticiaModal('${newsId}', '${news.type}', '${news.date}', '${news.url}')">
                                    <div class="d-flex w-100 justify-content-between mb-1">
                                        <small class="text-secondary fw-bold" style="font-size: 0.8em;"><i class="fa-regular fa-calendar me-1"></i> ${news.date}</small>
                                        <span class="badge bg-dark border border-secondary ${typeColor}" style="font-size: 0.7em;">${news.type}</span>
                                    </div>
                                    <p class="mb-0 text-light" style="font-size: 0.9rem;">${news.news}</p>
                                </div>
                            `;
                        });
                    }).catch(e => {
                        document.getElementById('news-list').innerHTML = '<div class="text-danger p-4 text-center">Erro ao carregar notícias do servidor oficial.</div>';
                    });

            } catch (error) {
                console.error("Erro geral na API TibiaData:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            atualizarRashid();
            fetchTibiaData();
        });
    </script>
</body>

</html>